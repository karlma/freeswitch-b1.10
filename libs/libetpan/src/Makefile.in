top_builddir = ..
prefix      = @prefix@
exec_prefix = @exec_prefix@
libdir      = @libdir@
includedir  = @includedir@
mandir      = @mandir@
bindir	    = @bindir@
SHELL       = /bin/sh
RM          = rm -fr
INSTALL	    = @INSTALL@
LIBTOOL	    = @LIBTOOL@
@SET_MAKE@

TARGET = libetpan@LIBSUFFIX@.la

VERSINFO    = @API_VERSION@
CC          = @CC@
LDFLAGS     = @LDFLAGS@ @LIBS@ @SSLLIBS@ @LIBICONV@ @DBLIB@ @GNUTLSLIB@ @SASLLIBS@

SUBLIBS = data-types/libdata-types.la \
	low-level/liblow-level.la \
	driver/libdriver.la \
	main/libmain.la \
	engine/libengine.la


SUBDIRS = data-types \
	low-level \
	driver \
	main \
	engine


all: $(TARGET)

$(TARGET): Makefile $(SUBLIBS)
	$(LIBTOOL) --mode=link $(CC) $(LDFLAGS) -o $@ $(SUBLIBS) \
	  -rpath $(libdir) -version-info $(VERSINFO)

$(SUBLIBS): all-recursive

install: all install-dirs install-recursive
	$(LIBTOOL) --mode=install $(INSTALL) -m 644 $(TARGET) $(DESTDIR)$(libdir)

install-dirs:
	$(INSTALL) -d -m 755 $(DESTDIR)$(libdir)

clean: clean-recursive
	$(RM) -fr $(TARGET) .libs

prepare: prepare-recursive

all-recursive install-recursive clean-recursive \
	distclean-recursive prepare-recursive:
	@set fnord $(MAKEFLAGS); amf=$$2; \
        list='$(SUBDIRS)'; for subdir in $$list; do \
         target=`echo $@ | sed s/-recursive//`; \
         echo "Making $$target in $$subdir"; \
         (cd $$subdir && $(MAKE) $$target) \
          || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
        done && test -z "$$fail"

Makefile: Makefile.in ../config.status
	cd ${top_builddir} && CONFIG_FILES=src/Makefile CONFIG_HEADERS= ./config.status

distclean: clean
	rm -rf Makefile 

